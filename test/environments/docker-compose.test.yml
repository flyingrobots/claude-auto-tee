version: '3.8'

services:
  # Basic Alpine Linux environment  
  alpine-test:
    build:
      context: ../../
      dockerfile: test/environments/Dockerfile.cross-platform
    volumes:
      - ../../:/app
      - test-results:/tmp/test-results
    environment:
      - NODE_ENV=test
      - PLATFORM=alpine
      - TEST_SUITE=graceful-degradation
      - GITHUB_ACTIONS=true
    working_dir: /app
    command: bash test/graceful-degradation-test.sh

  # Ubuntu environment for cross-platform testing
  ubuntu-test:
    image: ubuntu:22.04
    volumes:
      - ../../:/app
      - test-results:/tmp/test-results
    environment:
      - NODE_ENV=test
      - PLATFORM=ubuntu
      - TEST_SUITE=graceful-degradation
      - GITHUB_ACTIONS=true
    working_dir: /app
    command: bash -c "apt-get update && apt-get install -y bash && bash test/graceful-degradation-test.sh"

volumes:
  test-results: